Bootstrap: docker
From: ubuntu:20.04

%post
    # Update the package list and install necessary packages
        export DEBIAN_FRONTEND=noninteractive
        export TZ=Europe/Berlin
        apt-get update && apt-get install -y --no-install-recommends \
        build-essential \
        wget \
        curl git \
        pip

    wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-keyring_1.1-1_all.deb
    dpkg -i cuda-keyring_1.1-1_all.deb


    # Install CUDA
    apt-get update
    apt-get install -y cuda-compiler-11-8 cuda-cudart-dev-11-8 cuda-compiler-11-8 libcusolver-dev-11-8 libcublas-dev-11-8 libcusparse-dev-11-8 --no-install-recommends
    apt-get install -y libopenblas-dev liblapacke-dev --no-install-recommends

    # Clean up
    apt-get clean
    

%environment
    # Set up environment variables for CUDA
    export PATH=/usr/local/cuda-11.8/bin+:${PATH}
    export LD_LIBRARY_PATH=/usr/local/cuda-11.8/lib64+:${LD_LIBRARY_PATH}
    export PATH=~/.local/bin:$PATH
